<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">

<html lang="en">

<head>
  <meta http-equiv="content-type" content="text/html; charset=windows-1251" >
  <title>iiko.Front web api demo</title>
  <script type="text/javascript">
    function getComposedUrl() {
      var url = document.getElementById("txtUrl").value;
      var contloller = document.getElementById("cbController");
      var pathId = document.getElementById("txtPathId").value;
      var query = document.getElementById("txtQuery").value;
      var urlcontloller = url + contloller.value;
      if (pathId && pathId != "")
        urlcontloller += "/" + pathId;
      if (query && query != "")
        urlcontloller += "?" + query;
      getUrl(urlcontloller, true);
    }

    function getDirectUrl() {
      var urlOutput = document.getElementById("txtUrlOutput");
      getUrl(urlOutput.value, true);
    }

    function getUrl(urlcontloller, reset) {
      var json = document.getElementById("rbFormatJson").checked;
      var getOrderRequest = new XMLHttpRequest();
      getOrderRequest.open("GET", urlcontloller, true);
      if (json) {
        getOrderRequest.setRequestHeader("Accept", "application/json; charset=utf-8");
      } else {
        getOrderRequest.setRequestHeader("Accept", "application/xml; charset=utf-8");
      }
      getOrderRequest.withCredentials = true;
      var output = document.getElementById("txtOutput");
      if (reset)
        output.value = "";
      var urlOutput = document.getElementById("txtUrlOutput");
      var url = document.getElementById("txtUrl").value;
      urlOutput.value = urlcontloller;
      getOrderRequest.onerror = function (e) {
        output.value += "Error!\n";}
      getOrderRequest.onreadystatechange = function () {
        if (getOrderRequest.readyState == 4) {
          if (getOrderRequest.status == "200") {
            output.value += "Login by cookie \n\n";
            output.value += getOrderRequest.responseText + "\n";
          }
          else if (getOrderRequest.status == "404") {
            output.value += "URL not found \n\n";
            output.value += "Message: " + getOrderRequest.responseText + "\n";
          }
          else if (getOrderRequest.status == "401" || getOrderRequest.status == "403") {
            output.value += "Status: " + getOrderRequest.status + "\n";
            output.value += "Not Login\n\n";
            var moduleId = document.getElementById("txtModuleId").value;
            var urlLogin = url + "login/" + moduleId;
            var loginRequest = new XMLHttpRequest();
            loginRequest.withCredentials = true;
            loginRequest.open("POST", urlLogin, true);
            output.value += "Login URL: " + urlLogin + "\n";
            loginRequest.onreadystatechange = function () {
              if (loginRequest.readyState == 4) {
                if (loginRequest.status == "200") {
                  var result = JSON.parse(loginRequest.responseText);
                  output.value += "Login ID: " + result + "\n";
                  getUrl(urlcontloller, false);
                } else {
                  output.value += "Login failed.\n\n";
                  output.value += "Status: " + loginRequest.status + "\n";
                  output.value += "Message: " + loginRequest.responseText + "\n";
                }
              }
            };
            loginRequest.send();
          }
          else {
            output.value += "Status: " + getOrderRequest.status + "\n";
            output.value += "Message: " + getOrderRequest.responseText + "\n";
          }
        }
      };
      getOrderRequest.send();
    }

    function logout() {
      var url = document.getElementById("txtUrl").value;
      var urlOutput = document.getElementById("txtUrlOutput");
      var getOrderRequest = new XMLHttpRequest();
      var urlLogout = url + "Logout";
      urlOutput.value = urlLogout;
      getOrderRequest.open("GET", urlLogout, true);
      getOrderRequest.withCredentials = true;
      var output = document.getElementById("txtOutput");
      output.value = "";
      getOrderRequest.onreadystatechange = function () {
        if (getOrderRequest.readyState == 4 && getOrderRequest.status == "200") {
          output.value += "Logout done.\n\n";
        }
      };
      getOrderRequest.send();
    }
  </script>
</head>

<body>

  <table>
    <tr>
      <td>Url</td>
      <td colspan="2">
        <input type="text" name="txtUrl" id="txtUrl" value="http://127.0.0.1:9042/api/">
      </td>
    </tr>
    <tr>
      <td>Module id</td>
      <td>
        <input type="text" name="txtModuleId" id="txtModuleId" value="2050">
      </td>
      <td>
        <button onclick=" logout() ">Logout</button>
      </td>
    </tr>
    <tr>
      <td>Controller</td>
      <td colspan="2">
        <select id="cbController">
          <option value="quickmenu">quickmenu</option>
          <option value="kitchenorders">kitchenorders</option>
          <option selected value="orders">orders</option>
          <option value="productgroups">productgroups</option>
          <option value="products">products</option>
          <option value="sections">sections</option>
          <option value="tables">tables</option>
          <option value="users">users</option>
        </select>
      </td>
    </tr>
    <tr>
      <td>Path id</td>
      <td colspan="2">
        <input type="text" name="txtPathId" id="txtPathId" value="">
      </td>
    </tr>
    <tr>
      <td><a href="http://www.asp.net/web-api/overview/odata-support-in-aspnet-web-api/supporting-odata-query-options">Query</a></td>
      <td colspan="2">
        <input type="text" name="txtQuery" id="txtQuery" value="">
      </td>
    </tr>
    <tr>
      <td colspan="3">
        <button onclick="getComposedUrl()">Composed url</button>
      </td>
    </tr>
  </table>
  <p>
    <textarea name="txtUrlOutput" id="txtUrlOutput" rows="1" cols="120"></textarea>
    <br>
    <button onclick="getDirectUrl() ">Direct url</button>
  </p>
  <table>
    <tr>
      <td>Format</td>
      <td>
        <input type="radio" name="rbFormat" id="rbFormatJson" checked>JSON<br>
      </td>
      <td>
        <input type="radio" name="rbFormat">XML<br>
      </td>
    </tr>
  </table>
  <p>
    <textarea name="txtOutput" id="txtOutput" rows="40" cols="120"></textarea>
  </p>
</body>
</html>

